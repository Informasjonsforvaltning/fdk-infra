---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-llm-search-server
  namespace: prod
data:
  server.nginx-llm-search-server.conf: |
    server {
      # Use the mapped $client_ip
      set_real_ip_from 10.0.0.0/8;
      real_ip_header X-Forwarded-For;
      real_ip_recursive on;
      listen                8080;
      server_name           aisearch.api.fellesdatakatalog.digdir.no;
    
      location ~ ^/(ping|ready|prometheus) {
        deny all;
        return 404;
      }
    
      location / {
        limit_req zone=llm_limit burst=20 delay=10;
        proxy_pass http://fdk-llm-search-service:8080;
      }
    }
